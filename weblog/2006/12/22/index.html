<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
		<meta http-equiv="content-type" content="text/html;charset=ISO-8859-1" />
		<title>Dan Wood: The Eponymous Weblog (Archives) | by Dan Wood, Karelia Software</title>
		<meta name="description" content="Useful Tidbits and Egotistical Musings from Dan Wood, co-owner of Karelia Software. This blog mostly covers geeky topics like Mac Programming." />

<link rel="alternate" type="application/rss+xml" title="RSS" href="http://gigliwood.com/weblog/index.rss" />



<style type="text/css">

/* color palette: tinyurl.com/tgq5o */

body {
	background:#9191FF;
	margin:0;
	padding:0;
	font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size:76%;
	word-wrap:break-word;
	}


pre { word-wrap:normal !important;
		font:9px monaco;
		margin-right:-3px;
	background:white; padding: 3px; overflow:auto; }


.bio { font-size:80%; margin:auto; text-align:center; padding:10px 40px; }
.description { clear:all; color:white; font-weight:bold; font-size:120%; margin:auto; text-align:center; }

.categories { text-align:center; border-top:1px dashed #888; border-bottom:1px dashed #888; }

#frame {
	margin-left:auto;
	margin-right:auto;
	padding:0px;
	width:785px;
	overflow:auto;
	margin-bottom:80px;
	}
	
#heady {
	background:#12127D;
	color:#B37D00;
	padding:20px 10px 10px 10px;
}

#heady a:link              { color:#FFB200; text-decoration:underline; }
#heady a:visited           { color:#FFB200; text-decoration:none; }
#heady a:hover             { color:#C8C8FF; text-decoration:underline; }
#heady a:active            { color:#FFFFFF; text-decoration:underline; }

h1, h2, h3, h4 {
	margin:0;
}

h1 {
	padding-bottom:20px;
	font-weight:normal;
	font-family:Zapfino, Georgia, serif;
	text-shadow:white 0 0 20px;
	text-align:center;
}
	
#contentcenter {
	width: 565px;
	}

div.dateHeader {
	text-align:right;
	padding:5px;
	font-weight:bold;
	}

/* holds one item */
div.item {
	background:white;
	overflow:auto;
	}

/* sub-holds one item */
div.row {
  		}

div.row .label {
		float: left;
		width: 105px;
		}
		
p.postinfo {
		text-align: right;
		padding:10px 10px 5px 5px;
		font-size:70%;
		margin:0;
}
		
.label h2 {
	color:#12127D;
	font-size:140%;
	background:#ffB200;
	text-shadow:white 2 0 2px;
	padding:5px;
	margin:0;
	font-family:Georgia, serif;
	font-weight:normal;
}

.label img {
	padding:3px 0;
}

.label a:link              { color:#1919B3; text-decoration:none; }
.label a:visited           { color:#9191FF; text-decoration:none; }
.label a:hover             { color:#12127D; text-decoration:underline; }
.label a:active            { color:#B37D00; text-decoration:underline; }


div.row .value {
		float: left;
		width: 440px;
		text-align: left;
		padding:0 10px 60px 10px;
		background:#FFECBF;
		font-family:Georgia, serif;  font-size:110%;
		}

.value a:link              { color:#1919B3; text-decoration:none; }
.value a:visited           { color:#9191FF; text-decoration:none; }
.value a:hover             { color:#12127D; text-decoration:underline; }
.value a:active            { color:#B37D00; text-decoration:underline; }


#sidebar {
	background:#FFD980;
	width:200px;
	padding:20px 10px 80px 10px;
	height:100%;
	text-align:center;
	float:right;
	font-size:80%;
	}

#sidebar a:link              { color:#1919B3; font-weight:normal; text-decoration:underline; }
#sidebar a:visited           { color:#9191FF; font-weight:bold; text-decoration:none; }
#sidebar a:hover             { color:#12127D; font-weight:bold; text-decoration:underline; }
#sidebar a:active            { color:#B37D00; font-weight:bold; text-decoration:underline; }
	
div.calendar {
}
table.month-calendar {
	margin-left:auto;
	margin-right:auto;
	width:80%;
}

.month-calendar, .year-calendar {
	border-collapse:	collapse; 
}
.month-calendar-head, .year-calendar-head {
	background:		#cccccc;
	font-size:		110%;
	font-weight:		bold;
}
.month-calendar-day-head, .year-calendar-subhead {
	font-weight:		normal;
}

.month-calendar-day-noday,
.month-calendar-day-link,     .year-calendar-month-link,
.month-calendar-day-nolink,   .year-calendar-month-nolink,
.month-calendar-day-this-day, .year-calendar-this-month,
.month-calendar-day-future,   .year-calendar-month-future  {
	text-align:		center;
}

.month-calendar-day-future, .year-calendar-month-future {
	color:			#83660F;
}

.Saturday, .Sunday {
	background:		#eeeeee;
}

.month-calendar-day-this-day, .year-calendar-this-month {
	background:		#a5e4ff;
}

</style>

</head>

<body>
<div id="frame">
	<div id="heady">
		<h1>Dan Wood: The Eponymous Weblog <span style="font-size:70%;">(Archives)</span></h1>
		<p class="bio">
			<img style="float:right; margin-top:-20px; border:2px solid gray;" src="http://gigliwood.com/weblogpix/dan_wood.jpeg
" alt="Dan Wood" height="82" width="49" />
		<i>Dan Wood is co-owner of <a href="http://www.karelia.com/">Karelia Software</a>, creating programs for the Macintosh computer.  He is the father of two kids, lives in the Bay Area of California USA, and prefers bicycles to cars.  This site is his older weblog, which mostly covers geeky topics like Macs and Mac Programming.  <a href="http://gigliwood.com/blog">Go visit the current blog here.</a></i>
		</p>
		<p class="description">Useful Tidbits and Egotistical Musings from Dan Wood</p>
		<p class="categories"> <em>Categories:</em> 
		<a href="../../../Business/index.html">Business</a> &middot; 
		<a href="../../../MacOSX/index.html">Mac OS X</a> &middot; 
		<a href="../../../Cocoa/index.html">Cocoa Programming</a> &middot; 
		<a href="../../../General/index.html">General</a> &middot; 
		<a href="../../../index.html"><b>All Categories</b></a>
		</p>
	</div>
	<div id="sidebar">
		<h3>Calendar</h3>
		<div class="calendar">
			<table class="month-calendar"><caption class="month-calendar-head"><a title="November 2006 (1)" href="../../11/index.html">&larr;</a><a title="December 2006 (11)" href="../index.html">December</a><a title="January 2007 (10)" href="../../../2007/01/index.html">&rarr;</a></caption>
<tr>
<th class="month-calendar-day-head Sunday">Sun</th>
<th class="month-calendar-day-head Monday">Mon</th>
<th class="month-calendar-day-head Tuesday">Tue</th>
<th class="month-calendar-day-head Wednesday">Wed</th>
<th class="month-calendar-day-head Thursday">Thu</th>
<th class="month-calendar-day-head Friday">Fri</th>
<th class="month-calendar-day-head Saturday">Sat</th>
</tr>
<tr>
<td class="month-calendar-day-noday Sunday">&nbsp;</td>
<td class="month-calendar-day-noday Monday">&nbsp;</td>
<td class="month-calendar-day-noday Tuesday">&nbsp;</td>
<td class="month-calendar-day-noday Wednesday">&nbsp;</td>
<td class="month-calendar-day-noday Thursday">&nbsp;</td>
<td class="month-calendar-day-nolink Friday">1</td>
<td class="month-calendar-day-nolink Saturday">2</td>
</tr>
<tr>
<td class="month-calendar-day-nolink Sunday">3</td>
<td class="month-calendar-day-nolink Monday">4</td>
<td class="month-calendar-day-nolink Tuesday">5</td>
<td class="month-calendar-day-nolink Wednesday">6</td>
<td class="month-calendar-day-nolink Thursday">7</td>
<td class="month-calendar-day-nolink Friday">8</td>
<td class="month-calendar-day-nolink Saturday">9</td>
</tr>
<tr>
<td class="month-calendar-day-nolink Sunday">10</td>
<td class="month-calendar-day-nolink Monday">11</td>
<td class="month-calendar-day-nolink Tuesday">12</td>
<td class="month-calendar-day-nolink Wednesday">13</td>
<td class="month-calendar-day-nolink Thursday">14</td>
<td class="month-calendar-day-link Friday"><a title="Friday, 15 December 2006 (1)" href="../15/index.html">15</a></td>
<td class="month-calendar-day-nolink Saturday">16</td>
</tr>
<tr>
<td class="month-calendar-day-nolink Sunday">17</td>
<td class="month-calendar-day-nolink Monday">18</td>
<td class="month-calendar-day-link Tuesday"><a title="Tuesday, 19 December 2006 (1)" href="../19/index.html">19</a></td>
<td class="month-calendar-day-link Wednesday"><a title="Wednesday, 20 December 2006 (4)" href="../20/index.html">20</a></td>
<td class="month-calendar-day-nolink Thursday">21</td>
<td class="month-calendar-day-this-day Friday"><a title="Friday, 22 December 2006 (current) (3)" href="index.html">22</a></td>
<td class="month-calendar-day-nolink Saturday">23</td>
</tr>
<tr>
<td class="month-calendar-day-nolink Sunday">24</td>
<td class="month-calendar-day-nolink Monday">25</td>
<td class="month-calendar-day-nolink Tuesday">26</td>
<td class="month-calendar-day-nolink Wednesday">27</td>
<td class="month-calendar-day-link Thursday"><a title="Thursday, 28 December 2006 (1)" href="../28/index.html">28</a></td>
<td class="month-calendar-day-nolink Friday">29</td>
<td class="month-calendar-day-link Saturday"><a title="Saturday, 30 December 2006 (1)" href="../30/index.html">30</a></td>
</tr>
<tr>
<td class="month-calendar-day-nolink Sunday">31</td>
<td class="month-calendar-day-noday Monday">&nbsp;</td>
<td class="month-calendar-day-noday Tuesday">&nbsp;</td>
<td class="month-calendar-day-noday Wednesday">&nbsp;</td>
<td class="month-calendar-day-noday Thursday">&nbsp;</td>
<td class="month-calendar-day-noday Friday">&nbsp;</td>
<td class="month-calendar-day-noday Saturday">&nbsp;</td>
</tr>
</table>

		</div>

		<h3><a href="http://amzn.com/w/2663V7TM8IKKC">My Amazon WishList</a></h3>


		<p>Subscribe:
		   <a href="http://gigliwood.com/weblog/index.rss" title="RSS Feed for this category; drag link into a news reader program."><img  src="http://gigliwood.com/weblogpix/rss.gif" alt="RSS" border="0" /></a>
		</p>
		<p>
				<a href="mailto: dan at this domain">Feedback</a></i>
		</p>
		
		<p>
			<b>Also on this website</b>
			<a href="http://gigliwood.com/abcd/">A Basic Course in Dvorak</a> &middot;
			<a href="http://gigliwood.com/kenwood/Pickle/">The Pickle Machine</a> &middot;
			<a href="http://gigliwood.com/mentos/">The Mentos Gallery</a> &middot;
			<a href="http://gigliwood.com/tabletester">Cocoa Table Tester</a> &middot;
			<a href="http://gigliwood.com/wedding">Making your Wedding Make a Difference</a> &middot;
			</p>
		<p>
			<b>Sites I also work on</b>
			<a href="http://www.bikealameda.org/">BikeAlameda</a> &middot;
			<a href="http://progala.blogspot.com/">A Progressive Alamedan (my political blog)</a> &middot;
			<a href="http://www.karelia.com/">Karelia Software</a>
		</p>
		
		<p>
			<b>I'm also here:</b>
			<a href="http://twitter.com/danwood">danwood</a> on Twitter
		</p>
	</div> <!-- end sidebar -->

	<div id="contentcenter">





<div class="dateHeader">Fri, 22 Dec 2006</div>
<div class="item">
	<div class="row">
		<div class="label">
			<h2>Class Posing as a useful Debugging Technique</h2>
			<p class="postinfo">
				<a href="../../../Cocoa/Class_Posing_as_a_u.html">permanent link</a>
				&middot; Topic<a href="../../../Cocoa/">/Cocoa</a>
				<br />
				<a href="../../../Cocoa/"><img border="0" src="http://gigliwood.com/weblogpix/Cocoa.gif" alt="/Cocoa" /></a>
				
			</p>
		</div>
		<div class="value">
<p>
Third past today!  Since I just posted a "gripe" entry, I thought I would also post something constructive.  I wanted to talk about how cool class posing is for debugging.
</p>
<p>
We have used class posing quite a few times just to insert some extra warnings for our debug builds.  A lot of times, you can catch a nasty condition before it happens and provide some information about what's happening.  For instance, if you are only supposed to call a particular method from the main thread, a posed subclass could define your entry points to log an error message if it's being called from a background thread.
</p>
<p>
For example, I wanted to log some information whenever an <b>NSThread</b> got detached, so I could see where all my application's threads were coming from.  So I created a subclass of <b>NSThread</b> called, unimaginatively, <b>MyThread</b>:
</p>
<pre>
@interface MyThread : NSThread
@end
</pre>
<p>
This class has two methods (in an <tt>@implementation</tt> block, of course).  The first is used to force the subclass to be used in place of its parent class:
</p>
<pre>
+ (void) load
{
    [self poseAsClass:[NSThread class]];
}
</pre>
<p>
The second is a redefinition of <tt>+[NSThread detachNewThreadSelector: toTarget: withObject:]</tt>.  It logs some useful information and then calls the "super" implementation to actually do the work.  I've simplified my code a bit here but you should get the idea:
</p>
<pre>
+ (void)detachNewThreadSelector:(SEL)selector
                       toTarget:(id)target
                     withObject:(id)argument;
{
    LOG((@"Detach -[%@ %@%@]", target, NSStringFromSelector(selector),
        argument));
    [super detachNewThreadSelector:selector
                          toTarget:target
                        withObject:argument];
}
</pre>
<p>
Generally I don't need this logging to happen, so the code is normally commented out with <tt>#ifdef 0</tt>.  But when I need to know what's going on with threads, this is very helpful.
</p>
<p>
I've also use this technique to debug my bindings and log each instance of <tt>-[NSObject bind:toObject: withKeyPath: options:]</tt> and <tt>-[NSObject unbind:]</tt>, all the initialization methods on <b>QTMovie</b> to make sure that the movies are created on the main thread, and so forth.
</p></div>
	</div>
</div>
<div class="item">
	<div class="row">
		<div class="label">
			<h2>Things that make it hard to debug</h2>
			<p class="postinfo">
				<a href="../../../Cocoa/Things_that_make_it.html">permanent link</a>
				&middot; Topic<a href="../../../Cocoa/">/Cocoa</a>
				<br />
				<a href="../../../Cocoa/"><img border="0" src="http://gigliwood.com/weblogpix/Cocoa.gif" alt="/Cocoa" /></a>
				
			</p>
		</div>
		<div class="value"><p>
I'm going to channel Andy Rooney for this post.  The difference is, you as a reader get to comment, so if I've been living in my debugging cave for so long that I've failed to learn the appropriate debugging techniques, feel free to enlighten me!
</p>
<p>
<b>Gripe #1:</b> For some reason, Apple's crash catcher isn't noticing crashes in the app I'm working on, if I launch it normally (without XCode).  If you don't get the "unexpectedly quit" dialog, then you don't get a crash report.  And yet other applications get the crash report and log just fine &mdash; Safari crashed on me yesterday and I got the dialog and the log.
</p>
<p>
<b>Gripe #2:</b>Some crash logs come back with an application version of '???'.  They must be launched improperly so that the info.plist is not readable.  It's hard to know what version I'm examining in that case!
</p>
<p>
<b>Gripe #3:</b>Exceptions that were helpfully caught for me without giving me enough context information are really annoying.  for instance, check out this thing in a log:
</p>
<pre>
*** NSRunLoop ignoring exception '*** -[NSCFDictionary setObject:
forKey:]: attempt to insert nil value' that raised during posting of
delayed perform with target 181d2ce0 and selector 'processTasks'
</pre>
<p>
.... or ...
</p>
<pre>
Exception raised during posting of notification.  Ignored.  exception:
*** -[NSCFDictionary setHidden:]: selector not recognized
[self = 0x6b95f90]
</pre>
<p>
Yeah, I see that it's somewhere downstream from my method 'processTasks'.  But I don't know the dictionary or where it got set.
</p>
<p>
<b>Gripe #4:</b>Sometimes, symbols in a backtrace are returned to us, and when we look them up on our symbols build with atos, the resulting strings make absolutely no sense.  Sometimes.
</p>
<p>
OK, I'm done griping for now.  Back to happy, shiny thoughts of Christmas cheer!
</p></div>
	</div>
</div>
<div class="item">
	<div class="row">
		<div class="label">
			<h2>Better description of data</h2>
			<p class="postinfo">
				<a href="../../../Cocoa/Better_description_.html">permanent link</a>
				&middot; Topic<a href="../../../Cocoa/">/Cocoa</a>
				<br />
				<a href="../../../Cocoa/"><img border="0" src="http://gigliwood.com/weblogpix/Cocoa.gif" alt="/Cocoa" /></a>
				
			</p>
		</div>
		<div class="value"><p>
One thing that drives me crazy about debugging in XCode is how the default print-object command invokes <tt>debugDescription</tt> on an object.  Normally this is the same as <tt>description</tt>, but for certain data objects, it's much less readable than plain old <tt>description</tt>.  OK, it has a bit more information, but it's generally not what I'm looking for and it's formatted so poorly.
</p>
<p>
What I do in our application is to redefine <tt>debugDescription</tt> in terms of <tt>description</tt> for debug builds.  (I bracket this code within and <tt>#ifdef</tt> so it's not built for the release version.)  Here's <b>NSDictionary</b>:
</p>
<pre>
@implementation NSDictionary ( OverrideDebug )

- (NSString *)debugDescription
{
    return [self description];
}

@end
</pre>
<p>
I do something similar for <b>NSSet</b>.
</p>
<p>
Easy enough, right?  For <b>NSArray</b>, I've gone a step further by only printing the first 20 or so items in the array.  That way an array with thousands of items won't fill up my terminal!
</p>
<pre>
@implementation NSArray ( OverrideDebug )

- (NSString *)debugDescription
{
    #define MAXARRAYSHOW 20
    if ([self count] > MAXARRAYSHOW)
    {
        NSArray *subArray = [self subarrayWithRange:
            NSMakeRange(0,MAXARRAYSHOW)];
        return [NSString stringWithFormat:@"%@ [... %d items]",
                    [subArray description], [self count]];
    }
    else
    {
        return [self description];
    }
}
@end
</pre>
<p>
For <b>NSDictionary</b>, I've gone all out and made a much more useable <tt>description</tt>.  This implementation shows the data in a nicely formatted Hex/ASCII dump that's much more scannable.  I also cut it off at 1024 bytes since I don't really want to see much more than this, and I hate to have to wait for a megabyte-long chunk of data to finish displaying.
</p>
<p>
Note that I've also gone ahead and re-implemented <tt>description</tt>, not <tt>debugDescription</tt>, so I always get this new style of display.
</p>
<pre>
@implementation NSData ( description )

- (NSString *)description
{
#define MAXDATABYTES 1024
    unsigned char *bytes = (unsigned char *)[self bytes];
    unsigned length = [self length];
    NSMutableString *buf = [NSMutableString stringWithFormat:
        @"NSData %d bytes:\n", length];
    int i, j;

    for ( i = 0 ; i < length ; i += 16 )
    {
        if (i > MAXDATABYTES)       // don't print too much!
        {
            [buf appendString:@"\n...\n"];
            break;
        }
        for ( j = 0 ; j < 16 ; j++ )    // Show the row in Hex
        {
            int offset = i+j;
            if (offset < length)
            {
                [buf appendFormat:@"%02X ",bytes[offset]];
            }
            else
            {
                [buf appendFormat:@"   "];
            }
        }
        [buf appendString:@"| "];   // now show in ASCII
        for ( j = 0 ; j < 16 ; j++ )
        {
            int offset = i+j;
            if (offset < length)
            {
                unsigned char theChar = bytes[offset];
                if (theChar < 32 || theChar > 127)
                {
                    theChar ='.';
                }
                [buf appendFormat:@"%c", theChar];
            }
        }
        [buf appendString:@"\n"];
    }
    [buf deleteCharactersInRange:NSMakeRange([buf length]-1, 1)];
    return buf;
}
@end
</pre>
<p>
Can anybody think of more improvements to the standard ways out describing objects?
</p>
</div>
	</div>
</div>
	</div> <!-- end contentCenter -->
</div> <!-- end frame -->

</body>
</html>

