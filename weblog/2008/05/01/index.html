<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
		<meta http-equiv="content-type" content="text/html;charset=ISO-8859-1" />
		<title>Dan Wood: The Eponymous Weblog (Archives) | by Dan Wood, Karelia Software</title>
		<meta name="description" content="Useful Tidbits and Egotistical Musings from Dan Wood, co-owner of Karelia Software. This blog mostly covers geeky topics like Mac Programming." />

<link rel="alternate" type="application/rss+xml" title="RSS" href="http://gigliwood.com/weblog/index.rss" />



<style type="text/css">

/* color palette: tinyurl.com/tgq5o */

body {
	background:#9191FF;
	margin:0;
	padding:0;
	font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size:76%;
	word-wrap:break-word;
	}


pre { word-wrap:normal !important;
		font:9px monaco;
		margin-right:-3px;
	background:white; padding: 3px; overflow:auto; }


.bio { font-size:80%; margin:auto; text-align:center; padding:10px 40px; }
.description { clear:all; color:white; font-weight:bold; font-size:120%; margin:auto; text-align:center; }

.categories { text-align:center; border-top:1px dashed #888; border-bottom:1px dashed #888; }

#frame {
	margin-left:auto;
	margin-right:auto;
	padding:0px;
	width:785px;
	overflow:auto;
	margin-bottom:80px;
	}
	
#heady {
	background:#12127D;
	color:#B37D00;
	padding:20px 10px 10px 10px;
}

#heady a:link              { color:#FFB200; text-decoration:underline; }
#heady a:visited           { color:#FFB200; text-decoration:none; }
#heady a:hover             { color:#C8C8FF; text-decoration:underline; }
#heady a:active            { color:#FFFFFF; text-decoration:underline; }

h1, h2, h3, h4 {
	margin:0;
}

h1 {
	padding-bottom:20px;
	font-weight:normal;
	font-family:Zapfino, Georgia, serif;
	text-shadow:white 0 0 20px;
	text-align:center;
}
	
#contentcenter {
	width: 565px;
	}

div.dateHeader {
	text-align:right;
	padding:5px;
	font-weight:bold;
	}

/* holds one item */
div.item {
	background:white;
	overflow:auto;
	}

/* sub-holds one item */
div.row {
  		}

div.row .label {
		float: left;
		width: 105px;
		}
		
p.postinfo {
		text-align: right;
		padding:10px 10px 5px 5px;
		font-size:70%;
		margin:0;
}
		
.label h2 {
	color:#12127D;
	font-size:140%;
	background:#ffB200;
	text-shadow:white 2 0 2px;
	padding:5px;
	margin:0;
	font-family:Georgia, serif;
	font-weight:normal;
}

.label img {
	padding:3px 0;
}

.label a:link              { color:#1919B3; text-decoration:none; }
.label a:visited           { color:#9191FF; text-decoration:none; }
.label a:hover             { color:#12127D; text-decoration:underline; }
.label a:active            { color:#B37D00; text-decoration:underline; }


div.row .value {
		float: left;
		width: 440px;
		text-align: left;
		padding:0 10px 60px 10px;
		background:#FFECBF;
		font-family:Georgia, serif;  font-size:110%;
		}

.value a:link              { color:#1919B3; text-decoration:none; }
.value a:visited           { color:#9191FF; text-decoration:none; }
.value a:hover             { color:#12127D; text-decoration:underline; }
.value a:active            { color:#B37D00; text-decoration:underline; }


#sidebar {
	background:#FFD980;
	width:200px;
	padding:20px 10px 80px 10px;
	height:100%;
	text-align:center;
	float:right;
	font-size:80%;
	}

#sidebar a:link              { color:#1919B3; font-weight:normal; text-decoration:underline; }
#sidebar a:visited           { color:#9191FF; font-weight:bold; text-decoration:none; }
#sidebar a:hover             { color:#12127D; font-weight:bold; text-decoration:underline; }
#sidebar a:active            { color:#B37D00; font-weight:bold; text-decoration:underline; }
	
div.calendar {
}
table.month-calendar {
	margin-left:auto;
	margin-right:auto;
	width:80%;
}

.month-calendar, .year-calendar {
	border-collapse:	collapse; 
}
.month-calendar-head, .year-calendar-head {
	background:		#cccccc;
	font-size:		110%;
	font-weight:		bold;
}
.month-calendar-day-head, .year-calendar-subhead {
	font-weight:		normal;
}

.month-calendar-day-noday,
.month-calendar-day-link,     .year-calendar-month-link,
.month-calendar-day-nolink,   .year-calendar-month-nolink,
.month-calendar-day-this-day, .year-calendar-this-month,
.month-calendar-day-future,   .year-calendar-month-future  {
	text-align:		center;
}

.month-calendar-day-future, .year-calendar-month-future {
	color:			#83660F;
}

.Saturday, .Sunday {
	background:		#eeeeee;
}

.month-calendar-day-this-day, .year-calendar-this-month {
	background:		#a5e4ff;
}

</style>

</head>

<body>
<div id="frame">
	<div id="heady">
		<h1>Dan Wood: The Eponymous Weblog <span style="font-size:70%;">(Archives)</span></h1>
		<p class="bio">
			<img style="float:right; margin-top:-20px; border:2px solid gray;" src="http://gigliwood.com/weblogpix/dan_wood.jpeg
" alt="Dan Wood" height="82" width="49" />
		<i>Dan Wood is co-owner of <a href="http://www.karelia.com/">Karelia Software</a>, creating programs for the Macintosh computer.  He is the father of two kids, lives in the Bay Area of California USA, and prefers bicycles to cars.  This site is his older weblog, which mostly covers geeky topics like Macs and Mac Programming.  <a href="http://gigliwood.com/blog">Go visit the current blog here.</a></i>
		</p>
		<p class="description">Useful Tidbits and Egotistical Musings from Dan Wood</p>
		<p class="categories"> <em>Categories:</em> 
		<a href="../../../Business/index.html">Business</a> &middot; 
		<a href="../../../MacOSX/index.html">Mac OS X</a> &middot; 
		<a href="../../../Cocoa/index.html">Cocoa Programming</a> &middot; 
		<a href="../../../General/index.html">General</a> &middot; 
		<a href="../../../index.html"><b>All Categories</b></a>
		</p>
	</div>
	<div id="sidebar">
		<h3>Calendar</h3>
		<div class="calendar">
			<table class="month-calendar"><caption class="month-calendar-head"><a title="April 2008 (1)" href="../../04/index.html">&larr;</a><a title="May 2008 (3)" href="../index.html">May</a><a title="July 2008 (4)" href="../../07/index.html">&rarr;</a></caption>
<tr>
<th class="month-calendar-day-head Sunday">Sun</th>
<th class="month-calendar-day-head Monday">Mon</th>
<th class="month-calendar-day-head Tuesday">Tue</th>
<th class="month-calendar-day-head Wednesday">Wed</th>
<th class="month-calendar-day-head Thursday">Thu</th>
<th class="month-calendar-day-head Friday">Fri</th>
<th class="month-calendar-day-head Saturday">Sat</th>
</tr>
<tr>
<td class="month-calendar-day-noday Sunday">&nbsp;</td>
<td class="month-calendar-day-noday Monday">&nbsp;</td>
<td class="month-calendar-day-noday Tuesday">&nbsp;</td>
<td class="month-calendar-day-noday Wednesday">&nbsp;</td>
<td class="month-calendar-day-this-day Thursday"><a title="Thursday, 1 May 2008 (current) (3)" href="index.html">1</a></td>
<td class="month-calendar-day-nolink Friday">2</td>
<td class="month-calendar-day-nolink Saturday">3</td>
</tr>
<tr>
<td class="month-calendar-day-nolink Sunday">4</td>
<td class="month-calendar-day-nolink Monday">5</td>
<td class="month-calendar-day-nolink Tuesday">6</td>
<td class="month-calendar-day-nolink Wednesday">7</td>
<td class="month-calendar-day-nolink Thursday">8</td>
<td class="month-calendar-day-nolink Friday">9</td>
<td class="month-calendar-day-nolink Saturday">10</td>
</tr>
<tr>
<td class="month-calendar-day-nolink Sunday">11</td>
<td class="month-calendar-day-nolink Monday">12</td>
<td class="month-calendar-day-nolink Tuesday">13</td>
<td class="month-calendar-day-nolink Wednesday">14</td>
<td class="month-calendar-day-nolink Thursday">15</td>
<td class="month-calendar-day-nolink Friday">16</td>
<td class="month-calendar-day-nolink Saturday">17</td>
</tr>
<tr>
<td class="month-calendar-day-nolink Sunday">18</td>
<td class="month-calendar-day-nolink Monday">19</td>
<td class="month-calendar-day-nolink Tuesday">20</td>
<td class="month-calendar-day-nolink Wednesday">21</td>
<td class="month-calendar-day-nolink Thursday">22</td>
<td class="month-calendar-day-nolink Friday">23</td>
<td class="month-calendar-day-nolink Saturday">24</td>
</tr>
<tr>
<td class="month-calendar-day-nolink Sunday">25</td>
<td class="month-calendar-day-nolink Monday">26</td>
<td class="month-calendar-day-nolink Tuesday">27</td>
<td class="month-calendar-day-nolink Wednesday">28</td>
<td class="month-calendar-day-nolink Thursday">29</td>
<td class="month-calendar-day-nolink Friday">30</td>
<td class="month-calendar-day-nolink Saturday">31</td>
</tr>
</table>

		</div>

		<h3><a href="http://amzn.com/w/2663V7TM8IKKC">My Amazon WishList</a></h3>


		<p>Subscribe:
		   <a href="http://gigliwood.com/weblog/index.rss" title="RSS Feed for this category; drag link into a news reader program."><img  src="http://gigliwood.com/weblogpix/rss.gif" alt="RSS" border="0" /></a>
		</p>
		<p>
				<a href="mailto: dan at this domain">Feedback</a></i>
		</p>
		
		<p>
			<b>Also on this website</b>
			<a href="http://gigliwood.com/abcd/">A Basic Course in Dvorak</a> &middot;
			<a href="http://gigliwood.com/kenwood/Pickle/">The Pickle Machine</a> &middot;
			<a href="http://gigliwood.com/mentos/">The Mentos Gallery</a> &middot;
			<a href="http://gigliwood.com/tabletester">Cocoa Table Tester</a> &middot;
			<a href="http://gigliwood.com/wedding">Making your Wedding Make a Difference</a> &middot;
			</p>
		<p>
			<b>Sites I also work on</b>
			<a href="http://www.bikealameda.org/">BikeAlameda</a> &middot;
			<a href="http://progala.blogspot.com/">A Progressive Alamedan (my political blog)</a> &middot;
			<a href="http://www.karelia.com/">Karelia Software</a>
		</p>
		
		<p>
			<b>I'm also here:</b>
			<a href="http://twitter.com/danwood">danwood</a> on Twitter
		</p>
	</div> <!-- end sidebar -->

	<div id="contentcenter">





<div class="dateHeader">Thu, 01 May 2008</div>
<div class="item">
	<div class="row">
		<div class="label">
			<h2>An easy way to manage singleton window controllers</h2>
			<p class="postinfo">
				<a href="../../../Cocoa/An_easy_way_to_mana.html">permanent link</a>
				&middot; Topic<a href="../../../Cocoa/">/Cocoa</a>
				<br />
				<a href="../../../Cocoa/"><img border="0" src="http://gigliwood.com/weblogpix/Cocoa.gif" alt="/Cocoa" /></a>
				
			</p>
		</div>
		<div class="value"><p>
In <a href="http://www.sandvox.com/">Sandvox</a> and <a href="http://www.karelia.com/imedia/">iMedia Browser</a>, we use a number of utility windows that are singletons; there will be only one of any of them open.  Examples include the registration window, email list signup dialog, problem reporter window, and the release notes window.
</p>
<p>
I had noticed a lot of redundant code in each of these controllers' classes dealing with maintaining the single instance of that window, which we would store in a static variable and access with a lazy accessor, not unlike the technique <a href="http://developer.apple.com/documentation/Cocoa/Conceptual/LoadingCode/Tasks/Componentizing.html#//apple_ref/doc/uid/20001275-99902">here</a>.
</p>
<p>
When something starts to get repetitive, it's time to find a better way. So I created a class <tt>KSSingletonWindowController</tt> which manages the singleton instances. Instead of storing each instance of a window controller in its own static variable, it maintains a static reference to an <tt>NSMutableDictionary</tt> holding the window controllers, keyed by an identifier (generally the subclass name).
</p>
<p>
The class contains four class methods:
</p>
<pre>
@interface KSSingletonWindowController :  NSWindowController

+ (id)sharedController;
+ (id)sharedControllerWithoutLoading;
+ (id)sharedControllerNamed:(NSString *)registrationName;
+ (id)sharedControllerWithoutLoadingNamed:(NSString *)registrationName;

@end
</pre>
<p>To access a window controller, you only need to invoke <tt>sharedController</tt> on your subclass of <tt>KSSingletonWindowController</tt>. The object will be created if it is not yet registered, and then that single object will be returned to you.  If you want to get the instance but only if it has already been loaded (useful, for instance, in clean-up code or a response to a method to close a window; there's no point creating it if it hasn't already been created) you can use <tt>sharedControllerWithoutLoading</tt>.
</p>
<p>
If you need to have more than instance of a class, you would need to register each one with a different name.  For example, you might have one instance of RTFDWindowController which you use to show release notes, and another one for showing credits. You would use the methods <tt>sharedControllerNamed:</tt> and <tt>sharedControllerWithoutLoadingNamed:</tt>, passing in arbitrary strings to identify each unique instance.
</p>
<p>
Here is the implementation.  Each method builds upon the previous ones.
</p>
<pre>
static NSMutableDictionary *sControllerRegistry = nil;

@implementation KSSingletonWindowController
</pre>
<blockquote>
<tt>sharedControllerWithoutLoadingNamed:</tt> lazily instantiates the controller registry and looks up the entry for the given key.
</blockquote>
<pre>
+ (id)sharedControllerWithoutLoadingNamed:(NSString *)registrationName
{
  if (!sControllerRegistry)
  {
    sControllerRegistry = [[NSMutableDictionary alloc] init];
  }
  KSSingletonWindowController *result
    = [sControllerRegistry objectForKey:registrationName];
  return result;
}
</pre>
<blockquote>
<tt>sharedControllerNamed:</tt> looks up the named item.  It creates and stores the object if it wasn't allocated yet.
</blockquote>
<pre>
+ (id)sharedControllerNamed:(NSString *)registrationName
{
  KSSingletonWindowController *result
    = [self sharedControllerWithoutLoadingNamed:registrationName];
  if (!result)
  {
    result = [[[self alloc] init] autorelease];
    [sControllerRegistry setObject:result forKey:registrationName];
  }
  return result;
}
</pre>
<blockquote>
<tt>sharedController</tt> and <tt> sharedControllerWithoutLoading</tt> call their "named" counterparts using the name of the class as the key.  (Obviously, you would invoke <tt>+[<i>YourClass</i> sharedController]</tt>, not <tt>+[KSSingletonWindowController sharedController]</tt> for this to work.)
</blockquote>
<pre>
+ (id)sharedController;
{
  NSString *className = NSStringFromClass(self);
  return [self sharedControllerNamed:className];
}

+ (id)sharedControllerWithoutLoading;
{
  NSString *className = NSStringFromClass(self);
  return [self sharedControllerWithoutLoadingNamed:className];
}
</pre>
<p>
That should do it!  Please feel free to use and adapt this for your projects. Enjoy!
</p>
</div>
	</div>
</div>
<div class="item">
	<div class="row">
		<div class="label">
			<h2>A Cool Way to Integrate Web and Desktop</h2>
			<p class="postinfo">
				<a href="../../../Cocoa/A_Cool_Way_to_Integ.html">permanent link</a>
				&middot; Topic<a href="../../../Cocoa/">/Cocoa</a>
				<br />
				<a href="../../../Cocoa/"><img border="0" src="http://gigliwood.com/weblogpix/Cocoa.gif" alt="/Cocoa" /></a>
				
			</p>
		</div>
		<div class="value"><p>
Following the example of <a href="http://www.panic.com/">Panic</a> and others, we've put some code into our applicatons that, upon first launch, will ask people if they want to join our email announcement list.
</p>
<p>
One thing I don't like is when computers are dumb.  And what I thought would seem dumb would be the case where you are <i>already</i> on our email list, and you hear about our new app, so you download it from the link we provide, and upon launching said app, it asks you if you want to join the email list.  Well, duh!
</p>
<p>
So I mulled this over in the back of my head for a long time. Should we have a special version of our application that skips this question? Wow that would be a lot of hassle and be potentially confusing. Or would there be some way we could use AppleScript to set the user defaults for our application so that it wouldn't ask?  That would probably be pretty invasive and require the user running a script in ScriptEditor.  Or download a helper application that sets the stage in advance, then launches the real application?  Geez, that's not going to be obvious.  There must be a better way....
</p>
<p>
Somewhere along the way, it occurred to me: <i>Cookies</i>.  Yeah, that's it.  We can access the cookie store from Cocoa; it's the same cookie store used by Safari or other Webkit-based browsers. True, some Mac users are using Firefox or Camino, but this might solve it for a good chunk of users.
</p>
<p>
So what I did was to store a cookie associated with our website onn the page that a person goes to when they have confirmed that they want to sign up for our mailing list.  I also set that same cookie when somebody clicks on the download link in our email blast; the link takes them to a page that sets the cookie and starts downloading the desired file.
</p>
<p>
Our application, upon launching, first checks the user default that will be set to prevent being asked more than once. If that has not been set yet, it checks the cookie store.  If the cookie indicating that the they are on our email list is present, then they will be spared the redundant question. Only if the default and the cookie are absent will they be bothered.
</p>
<p>
The cool thing is that this cookie works across multiple applications.  The cookie check is built into <a href="http://www.karelia.com/imedia">iMedia Browser 1.1</a>, which we just released this morning, but we will be building it into Sandvox as well. Once that cookie is set, they won't be asked again from any of our applications.  Well, at least until the cookie expires &mdash;&#160;but by then they will have stored the user default to prevent being asked.
</p>
<p>
Clearly, this is not a fool-proof technique.  The cookie store might not have been written to disk by the time somebody launches the application.  The user might have cleared out their cookies, or isn't using a Webkit-based browser.  But it's an interesting, light-weight mechanism for "communicating" between Browser and Desktop.
</p>
<p>
Naturally the next thing to think about is "What else could you accomplish with this technique?"  You could set cookies on your company's website that your desktop application might be able to take advantage of, e.g. your most recent login ID (but not password of course), recently visited pages, and so forth.  The "communication" could go the other way as well; a desktop application might set some cookies that help give the corresponding website some hints for web content.
</p>
<p>
This is a very "weak" form of communication.  If you want to literally control your Desktop application from a website, you could put in hyperlinks to custom URLs that your application can respond to by implementing <a href="http://www.cocoadev.com/index.pl?HowToRegisterURLHandler">this kind of code</a>.  (For instance, <a href="imedia://reply/n=29447&s=sample+feedback&d=I+clicked+on+the+link+from+the+web+page">this link</a>, if you already have been running iMedia Browser, will open up the application's feedback window with some pre-populated fields; we've set this up to help people follow up on tech support issues.)  And of course from your desktop application you can open up arbitrary URLs in your browser using <tt>NSWorkspace</tt> operations.
</p>
<p>
But when you want non-obtrusive passing of interesting data or settings between desktop and browser, this may be a useful technique.
</p></div>
	</div>
</div>
<div class="item">
	<div class="row">
		<div class="label">
			<h2>Self-Registering Transformers</h2>
			<p class="postinfo">
				<a href="../../../Cocoa/Self-Registering_Tr.html">permanent link</a>
				&middot; Topic<a href="../../../Cocoa/">/Cocoa</a>
				<br />
				<a href="../../../Cocoa/"><img border="0" src="http://gigliwood.com/weblogpix/Cocoa.gif" alt="/Cocoa" /></a>
				
			</p>
		</div>
		<div class="value"><p>
Here is a snippet of code you can put into any subclass of <tt>NSValueTransformer</tt> that will cause it to automatically register itself when the class is loaded. This is useful for almost all value transformers, except perhaps those that you need to be given a parameter in the initialization process, such as <a href="http://lists.apple.com/archives/Cocoa-dev/2004/Jun/msg01762.html">these cool transformer classes</a>.
</p>
<p>This code will just cause the transformer to be registered with the name of the class itself. So if you class was, for instance, <tt>CondenseTransformer</tt> then you would specify "CondenseTransformer" in your nib file.
</p>
<pre>
+ (void)load
{
  NSAutoreleasePool *pool = [[NSAutoreleasePool alloc] init];
  NSValueTransformer *theTransformer = [[[self alloc] init] autorelease];
  [NSValueTransformer setValueTransformer:theTransformer
         forName:NSStringFromClass([self class])];
  [pool release];
}
</pre></div>
	</div>
</div>
	</div> <!-- end contentCenter -->
</div> <!-- end frame -->

</body>
</html>

